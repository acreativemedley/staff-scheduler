<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>Scheduling System Setup</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      h1 {
        color: #1f4e79;
        border-bottom: 2px solid #1f4e79;
        padding-bottom: 10px;
      }
      h2 {
        color: #2c5f2d;
        margin-top: 30px;
      }
      .button {
        background-color: #4CAF50;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
        display: inline-block;
        text-decoration: none;
      }
      .button:hover {
        background-color: #45a049;
      }
      .button.secondary {
        background-color: #2196F3;
      }
      .button.secondary:hover {
        background-color: #1976D2;
      }
      .status {
        margin: 20px 0;
        padding: 15px;
        border-radius: 4px;
        font-weight: bold;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #e2e3e5;
        color: #383d41;
        border: 1px solid #d6d8db;
      }
      .code {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 10px;
        font-family: monospace;
        margin: 10px 0;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìÖ Scheduling System Setup</h1>
      
      <div id="status" class="status info">
        Ready to set up your Google Forms scheduling system!
      </div>
      
      <h2>üóÑÔ∏è Database</h2>
      <p><strong>Database URL:</strong> <a href="https://docs.google.com/spreadsheets/d/1qnB2yCNtKMHwCclaVeZqoxwalkNou5doShfeEg10pRw/edit" target="_blank">View Database</a></p>
      <p><strong>Status:</strong> ‚úÖ Created and configured</p>
      
      <h2>üìã Step 1: Create Forms</h2>
      <p>Click the button below to create the Google Forms for your scheduling system:</p>
      <button class="button" onclick="createForms()">üöÄ Create Google Forms</button>
      
      <h2>‚öôÔ∏è Step 2: Set Up Processing</h2>
      <p>After forms are created, set up automatic response processing:</p>
      <button class="button secondary" onclick="setupTriggers()" disabled id="triggerBtn">‚ö° Setup Form Triggers</button>
      
      <h2>üß™ Step 3: Test System</h2>
      <p>Test the forms and verify everything is working:</p>
      <button class="button secondary" onclick="testForms()" disabled id="testBtn">üîç Test Forms</button>
      
      <div id="results" class="code" style="display: none;"></div>
      
      <h2>üìã Created Forms</h2>
      <div id="formLinks" style="display: none;">
        <p><strong>Time-Off Request Form:</strong> <span id="timeOffLink">Pending...</span></p>
        <p><strong>Staff Registration Form:</strong> <span id="staffRegLink">Pending...</span></p>
      </div>
    </div>

    <script>
      function showStatus(message, type = 'info') {
        const statusDiv = document.getElementById('status');
        statusDiv.className = `status ${type}`;
        statusDiv.textContent = message;
      }
      
      function showResults(text) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.textContent = text;
        resultsDiv.style.display = 'block';
      }
      
      function createForms() {
        showStatus('Creating Google Forms... This may take a minute.', 'info');
        
        google.script.run
          .withSuccessHandler(function(result) {
            showStatus('‚úÖ Forms created successfully!', 'success');
            showResults(`Forms Created:
Time-Off Form URL: ${result.timeOffFormUrl}
Staff Registration Form URL: ${result.staffRegistrationFormUrl}
Form IDs stored in database Config sheet.`);
            
            // Show form links
            document.getElementById('formLinks').style.display = 'block';
            document.getElementById('timeOffLink').innerHTML = `<a href="${result.timeOffFormUrl}" target="_blank">Open Form</a>`;
            document.getElementById('staffRegLink').innerHTML = `<a href="${result.staffRegistrationFormUrl}" target="_blank">Open Form</a>`;
            
            // Enable next step buttons
            document.getElementById('triggerBtn').disabled = false;
            document.getElementById('testBtn').disabled = false;
          })
          .withFailureHandler(function(error) {
            showStatus('‚ùå Error creating forms: ' + error.message, 'error');
            showResults('Error: ' + error.toString());
          })
          .main();
      }
      
      function setupTriggers() {
        showStatus('Setting up form response triggers...', 'info');
        
        google.script.run
          .withSuccessHandler(function() {
            showStatus('‚úÖ Form triggers set up successfully!', 'success');
            showResults('Triggers configured. Form responses will now be automatically processed.');
          })
          .withFailureHandler(function(error) {
            showStatus('‚ùå Error setting up triggers: ' + error.message, 'error');
            showResults('Error: ' + error.toString());
          })
          .setupTriggers();
      }
      
      function testForms() {
        showStatus('Testing forms and database connection...', 'info');
        
        google.script.run
          .withSuccessHandler(function(result) {
            showStatus('‚úÖ Forms tested successfully!', 'success');
            showResults(`Test Results:
Time-Off Form: ${result.timeOffFormUrl || 'Not found'}
Staff Registration Form: ${result.staffRegistrationFormUrl || 'Not found'}

Database connection: Working
Staff names available: Check console for details`);
          })
          .withFailureHandler(function(error) {
            showStatus('‚ùå Error testing forms: ' + error.message, 'error');
            showResults('Error: ' + error.toString());
          })
          .testForms();
      }
    </script>
  </body>
</html>